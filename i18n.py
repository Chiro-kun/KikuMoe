from typing import Dict

I18N: Dict[str, Dict[str, str]] = {
    'it': {
        'app_title': 'LISTEN.moe Player',
        'header': 'LISTEN.moe - {channel} - {format}',
        'channel_label': 'Canale:',
        'format_label': 'Formato:',
        'language_label': 'Lingua:',
        'play': 'Riproduci',
        'pause': 'Pausa',
        'stop': 'Stop',
        'volume': 'Volume',
        'mute': 'Muto',
        'unmute': 'Riattiva audio',
        'now_playing_prefix': 'In riproduzione:',
        'status_opening': 'Apertura…',
        'status_buffering': 'Buffering…',
        'status_buffering_pct': 'Buffering… {pct}% ',
        'status_playing': 'In riproduzione!',
        'status_paused': 'In pausa.',
        'status_stopped': 'Fermo.',
        'status_ended': 'Stream terminato.',
        'status_error': 'Errore di riproduzione.',
        'status_restarting': 'Riavvio dello stream…',
        'ws_closed_reconnect': 'In riproduzione: WS chiuso, riconnessione...',
        'ws_error_prefix': 'In riproduzione: errore WS: ',
        'unknown': 'Sconosciuto',
        # Timer di sessione
        'session_timer': 'Sessione: {time}',
        'settings_session_timer_enable': 'Mostra timer di sessione',
        'settings_session_timer_tip': 'Mostra il tempo trascorso dall’avvio dell’app (si azzera alla chiusura).',
        'libvlc_not_ready': 'Backend non inizializzato. Installa FFmpeg (consigliato) o imposta il percorso di libVLC dalle Impostazioni.',
        'libvlc_init_failed': 'Impossibile inizializzare il backend. Verifica FFmpeg/libVLC e la compatibilità (x64/x86).',
        'libvlc_button': 'Imposta percorso VLC…',
        'libvlc_choose_title': 'Seleziona cartella VLC',
        'libvlc_saved_ok': 'Percorso VLC salvato. Prova a riprodurre lo stream.',
        'libvlc_saved_fail': 'Impossibile inizializzare VLC con il percorso selezionato.',
        'libvlc_hint': 'Suggerimento: installa FFmpeg e assicurati che sia nel PATH. In alternativa, scegli la cartella che contiene libvlc.dll (es. C:/Program Files/VideoLAN/VLC) e verifica che l’architettura corrisponda a Python.',
        # Nuove chiavi per indicatori/Tray/dettagli VLC
        'vlc_present': 'Backend disponibile',
        'vlc_not_found': 'Backend non disponibile',
        'vlc_version_label': 'Versione backend:',
        'vlc_path_label': 'Percorso backend:',
        'vlc_path_system': 'Sistema/PATH',
        'tray_show': 'Mostra finestra',
        'tray_hide': 'Nascondi finestra',
        'tray_play_pause': 'Play/Pausa',
        'tray_stop': 'Stop',
        'tray_mute': 'Muto',
        'tray_unmute': 'Riattiva audio',
        'tray_channel': 'Canale',
        'tray_format': 'Formato (codec)',
        'tray_quit': 'Esci',
        # Intestazioni di sezione per il menu Tray
        'tray_section_playback': 'Riproduzione',
        'tray_section_window': 'Finestra',
        'tray_section_preferences': 'Preferenze',
        # Chiavi per finestra impostazioni
        'settings_button': 'Impostazioni',
        'settings_title': 'Impostazioni',
        'settings_autoplay': 'Avvio automatico playback all’apertura',
        'settings_language': 'Selezione lingua',
        'settings_channel': 'Canale di default',
        'settings_format': 'Formato di default',
        'settings_volume': 'Volume di default',
        'settings_mute': 'Muto di default',
        'settings_vlc_path': 'Percorso VLC',
        'settings_browse': 'Sfoglia…',
        'settings_tray_enable': 'Abilita tray',
        'settings_tray_notifications': 'Notifiche brano in tray',
        'settings_tray_hide_on_minimize': 'Nascondi in tray quando minimizzata',
        'settings_network_caching': 'Caching di rete (ms)',
        'settings_ok': 'OK',
        'settings_cancel': 'Annulla',
        'settings_apply': 'Applica',
        # Audio device selection
        'settings_audio_output': 'Uscita audio',
        'settings_audio_default': 'Sistema (predefinito di Windows)',
        'settings_audio_refresh': 'Aggiorna',
        # Sleep Timer & Dark Mode
        'sleep_timer': 'Sleeptimer',
        'sleep_minutes': 'Minuti:',
        'sleep_start': 'Avvia',
        'sleep_cancel': 'Annulla',
        'sleep_remaining': 'Sleep tra {time}',
        'settings_dark_mode': 'Tema scuro',
        # Opzione: stop allo scadere Sleep Timer
        'settings_sleep_stop_on_end': 'Alla scadenza Sleep Timer: ferma riproduzione',
        # Dev console
        'settings_dev_console': 'Abilita console sviluppatore',
        'settings_dev_console_show_dev': 'Mostra messaggi con tag [DEV]',
        'dev_console_button': 'Console',
        'dev_console_title': 'Console sviluppatore',
        'dev_console_clear': 'Pulisci',
        'dev_console_copy': 'Copia tutto',
        'dev_console_pause': 'Pausa',
        'dev_console_resume': 'Riprendi',
        'dev_console_save': 'Salva...',
        'dev_console_autoscroll': 'Autoscroll',
        'dev_console_wrap': 'A capo automatico',
        'dev_console_level': 'Filtro livello',
        'dev_console_placeholder': 'I log appariranno qui...'
        ,
        # Volume zero safeguard
        'volume_zero_title': 'Volume a zero',
        'volume_zero_text': 'Il volume è impostato a 0. Vuoi ripristinarlo al 60%?',
        'restore': 'Ripristina',
        'tt_play': 'Riproduci',
        'tt_pause': 'Pausa/Riprendi',
        'tt_stop': 'Ferma riproduzione',
        'tt_mute': 'Disattiva audio',
        'tt_unmute': 'Riattiva audio',
    },
    'en': {
        'app_title': 'LISTEN.moe Player',
        'header': 'LISTEN.moe - {channel} - {format}',
        'channel_label': 'Channel:',
        'format_label': 'Format:',
        'language_label': 'Language:',
        'play': 'Play',
        'pause': 'Pause',
        'stop': 'Stop',
        'volume': 'Volume',
        'mute': 'Mute',
        'unmute': 'Unmute',
        'now_playing_prefix': 'Now Playing:',
        'status_opening': 'Opening…',
        'status_buffering': 'Buffering…',
        'status_buffering_pct': 'Buffering… {pct}% ',
        'status_playing': 'Playing!',
        'status_paused': 'Paused.',
        'status_stopped': 'Stopped.',
        'status_ended': 'Stream ended.',
        'status_error': 'Playback error.',
        'status_restarting': 'Restarting stream…',
        'ws_closed_reconnect': 'Now Playing: WS closed, reconnecting...',
        'ws_error_prefix': 'Now Playing: WS error: ',
        'unknown': 'Unknown',
        # Session timer
        'session_timer': 'Session: {time}',
        'settings_session_timer_enable': 'Show session timer',
        'settings_session_timer_tip': 'Display elapsed time since app start (resets on close).',
        'libvlc_not_ready': 'Backend not initialized. Install FFmpeg (recommended) or set libVLC path in Settings.',
        'libvlc_init_failed': 'Failed to initialize backend. Check FFmpeg/libVLC and architecture (x64/x86).',
        'libvlc_button': 'Set VLC Path…',
        'libvlc_choose_title': 'Select VLC folder',
        'libvlc_saved_ok': 'VLC path saved. Try playing the stream.',
        'libvlc_saved_fail': 'Failed to initialize VLC with the selected path.',
        'libvlc_hint': 'Hint: install FFmpeg and ensure it is in PATH. Alternatively, choose the folder containing libvlc.dll (e.g., C:/Program Files/VideoLAN/VLC) and ensure architecture matches Python.',
        # New keys for indicators/Tray/VLC details
        'vlc_present': 'Backend available',
        'vlc_not_found': 'Backend not available',
        'vlc_version_label': 'Backend Version:',
        'vlc_path_label': 'Backend Path:',
        'vlc_path_system': 'System/PATH',
        'tray_show': 'Show window',
        'tray_hide': 'Hide window',
        'tray_play_pause': 'Play/Pause',
        'tray_stop': 'Stop',
        'tray_mute': 'Mute',
        'tray_unmute': 'Unmute',
        'tray_channel': 'Channel',
        'tray_format': 'Format/Codec',
        'tray_quit': 'Quit',
        # Section headers for Tray menu
        'tray_section_playback': 'Playback',
        'tray_section_window': 'Window',
        'tray_section_preferences': 'Preferences',
        # Keys for settings window
        'settings_button': 'Settings',
        'settings_title': 'Settings',
        'settings_autoplay': 'Autoplay on startup',
        'settings_language': 'Language',
        'settings_channel': 'Default channel',
        'settings_format': 'Default format',
        'settings_volume': 'Default volume',
        'settings_mute': 'Default mute',
        'settings_vlc_path': 'VLC path',
        'settings_browse': 'Browse…',
        'settings_tray_enable': 'Enable tray icon',
        'settings_tray_notifications': 'Song notifications in tray',
        'settings_tray_hide_on_minimize': 'Hide to tray when minimized',
        'settings_network_caching': 'Network caching (ms)',
        'settings_ok': 'OK',
        'settings_cancel': 'Cancel',
        'settings_apply': 'Apply',
        # Audio device selection
        'settings_audio_output': 'Audio output',
        'settings_audio_default': 'System (Windows default device)',
        'settings_audio_refresh': 'Refresh',
        # Sleep Timer & Dark Mode
        'sleep_timer': 'Sleep timer',
        'sleep_minutes': 'Minutes:',
        'sleep_start': 'Start',
        'sleep_cancel': 'Cancel',
        'sleep_remaining': 'Sleep in {time}',
        'settings_dark_mode': 'Dark mode',
        # Option: stop when Sleep Timer elapses
        'settings_sleep_stop_on_end': 'When Sleep Timer elapses: stop playback',
        # Dev console
        'settings_dev_console': 'Enable developer console',
        'settings_dev_console_show_dev': 'Show messages tagged [DEV]',
        'dev_console_button': 'Console',
        'dev_console_title': 'Developer Console',
        'dev_console_clear': 'Clear',
        'dev_console_copy': 'Copy all',
        'dev_console_pause': 'Pause',
        'dev_console_resume': 'Resume',
        'dev_console_save': 'Save...',
        'dev_console_autoscroll': 'Autoscroll',
        'dev_console_wrap': 'Wrap',
        'dev_console_level': 'Level filter',
        'dev_console_placeholder': 'Logs will appear here...'
        ,
        # Volume zero safeguard
        'volume_zero_title': 'Volume is zero',
        'volume_zero_text': 'Volume is set to 0. Do you want to restore it to 60%?',
        'restore': 'Restore',
        'tt_play': 'Play',
        'tt_pause': 'Pause/Resume',
        'tt_stop': 'Stop playback',
        'tt_mute': 'Mute',
        'tt_unmute': 'Unmute',
    },
}


class I18n:
    def __init__(self, lang: str) -> None:
        self.lang = 'it' if lang not in ('it', 'en') else lang

    def set_lang(self, lang: str) -> None:
        self.lang = 'it' if lang not in ('it', 'en') else lang

    def t(self, key: str, **kwargs) -> str:
        try:
            txt = I18N[self.lang][key]
            return txt.format(**kwargs) if kwargs else txt
        except Exception:
            return I18N['it'].get(key, key)